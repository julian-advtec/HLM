<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Panel TV</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="/tv.css">
</head>

<body>
    <div class="tv-container">
        <div class="superior">
            <div class="logo-container">
                <img src="media/Logo1.png" alt="Logo" class="logo-img">
            </div>
            <div></div>
            <div></div>
            <div class="fecha-hora" id="fechaHora"></div>
        </div>


        <!-- üü® Centro -->
        <div class="centro">

            <div id="media-container">
                <img id="media-image" style="display:none;" />
                <video id="media-video" autoplay loop muted style="display:none;"></video>
            </div>


            <div class="datos-container" id="datos-container">
                <div class="titulos-fila">
                    <div class="titulo">Paciente</div>
                    <div class="titulo">Estado</div>
                </div>
            </div>


        </div>

        <!-- üü© Inferior -->
        <div class="inferior">
            <div>Pie 1</div>
            <div>Pie 2</div>
            <div>Pie 3</div>
        </div>
    </div>

    <script>
        const socket = io();
        const mediaImg = document.getElementById('media-image');
        const mediaVid = document.getElementById('media-video');

        socket.on('update', ([datos0, datos1]) => {
            const container = document.getElementById('datos-container');
            const maxToShow = 5;

            container.innerHTML = `
        <div class="titulos-fila">
          <div class="titulo">Paciente</div>
          <div class="titulo">Estado</div>
        </div>
      `;

            for (let i = 0; i < maxToShow; i++) {
                const paciente = datos0[i] || '';
                const estado = datos1[i] || '';
                container.innerHTML += `
          <div class="fila">
            <div class="dato izquierda">${paciente}</div>
            <div class="dato derecha">${estado}</div>
          </div>
        `;
            }
        });

        let mediaFiles = [], mediaIndex = 0;

        fetch('/media-files')
            .then(res => res.json())
            .then(files => {
                mediaFiles = files;
                if (mediaFiles.length > 0) {
                    mostrarMedia();
                    setInterval(mostrarMedia, 30000);
                }
            });

        function mostrarMedia() {
            if (!mediaFiles.length) return;
            const file = mediaFiles[mediaIndex];
            const url = `/media/${file}`;
            const ext = file.split('.').pop().toLowerCase();

            if (['mp4', 'webm'].includes(ext)) {
                mediaImg.style.display = 'none';
                mediaVid.src = url;
                mediaVid.style.display = 'block';
            } else {
                mediaVid.style.display = 'none';
                mediaImg.src = url;
                mediaImg.style.display = 'block';
            }

            mediaIndex = (mediaIndex + 1) % mediaFiles.length;
        }

        function actualizarFechaHora() {
            const ahora = new Date();

            const dias = ["Domingo", "Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado"];
            const meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

            const diaSemana = dias[ahora.getDay()];
            const dia = ahora.getDate().toString().padStart(2, '0');
            const mes = meses[ahora.getMonth()];
            const a√±o = ahora.getFullYear();

            const hora = ahora.getHours().toString().padStart(2, '0');
            const minutos = ahora.getMinutes().toString().padStart(2, '0');
            const segundos = ahora.getSeconds().toString().padStart(2, '0');

            const fechaTexto = `${diaSemana}, ${dia} de ${mes} de ${a√±o}`;
            const horaTexto = `${hora}:${minutos}:${segundos}`;

            document.getElementById('fechaHora').innerHTML = `
    <div>${fechaTexto}</div>
    <div>${horaTexto}</div>
  `;
        }

        setInterval(actualizarFechaHora, 1000);
        actualizarFechaHora();

    </script>
</body>

</html>